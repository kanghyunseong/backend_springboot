<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kh.pcar.back.boards.imgBoard.model.dao.ImgBoardMapper" >
	<sql id="imgBoardColumn">
	SELECT
           I.IMG_BOARD_NO imgBoardNo
         , I.IMG_BOARD_TITLE imgBoardTitle
         , M.USER_ID imgBoardWriter
         , I.IMG_BOARD_CONTENT imgBoardContent
         , I.IMG_COUNT imgCount
         , I.IMG_BOARD_STATUS imgBoardStatus
         , I.IMG_BOARD_DATE imgBoardDate
	</sql>

    <!-- 게시글 INSERT (boardWriter = USER_ID 문자열 → USER_NO로 변환) -->
    <insert id="imgSave" parameterType="ImgBoardVO">
        INSERT 
          INTO 
        	   TB_IMG_BOARD I
        	   (
        	   I.IMG_BOARD_NO
        	 , I.IMG_BOARD_TITLE
        	 , I.IMG_BOARD_WRITER
       		 , I.IMG_BOARD_CONTENT
        	 , I.IMG_COUNT
        	 , I.IMG_BOARD_DATE
        	 , I.IMG_BOARD_STATUS
        	   )
        VALUES 
        	   (
               SEQ_INO.NEXTVAL
           	 , #{imgBoardTitle}
             , (SELECT M.USER_NO FROM TB_MEMBER M WHERE M.USER_ID = #{imgBoardWriter})
             , #{imgBoardContent}
             , DEFAULT     
             , DEFAULT     
             , DEFAULT       
        )
    </insert>

    <!-- 게시글 목록 조회 (writer는 USER_ID로 가져오기) -->
    <select id="imgFindAll" resultType="ImgBoardDTO">
      <include refid="imgBoardColumn" />
        FROM 
        	 TB_IMG_BOARD I
        JOIN 
        	 TB_MEMBER M ON I.IMG_BOARD_WRITER = M.USER_NO
       WHERE 
       		 I.IMG_BOARD_STATUS = 'Y'
       ORDER 
       	  BY 
       	  	 I.IMG_BOARD_NO DESC
    </select>
    <!-- RowBounds는 자바에서 넘겨주니까 XML은 LIMIT/OFFSET 안 써도 됨 -->

    <!-- 단일 게시글 조회 -->
    <select id="findByImgBoardNo" resultType="ImgBoardDTO" parameterType="long">
        FROM 
        	 TB_IMG_BOARD I
        JOIN 
        	 TB_MEMBER M ON I.IMG_BOARD_WRITER = M.USER_NO
       WHERE 
       		 I.IMG_BOARD_NO = #{imgBoardNo}
         AND 
         	 I.IMG_BOARD_STATUS = 'Y'
    </select>

    <!-- 게시글 수정 -->
    <update id="imgUpdate" parameterType="ImgBoardDTO">
        UPDATE 
        	   TB_IMG_BOARD I
           SET 
           	   I.IMG_BOARD_TITLE   = #{imgBoardTitle}
             , I.IMG_BOARD_CONTENT = #{imgBoardContent}
         WHERE 
         	   I.IMG_BOARD_NO = #{imgBoardNo}
           AND 
           	   I.IMG_BOARD_WRITER = #{loginUserNo}
    </update>

    <!-- 게시글 삭제 -->
    <update id="deleteByImgBoardNo">
        UPDATE 
        	   TB_IMG_BOARD I
           SET 
           	   I.IMG_BOARD_STATUS = 'N'
         WHERE 
         	   I.IMG_BOARD_NO = #{imgBoardNo}
           AND 
           	   I.IMG_BOARD_WRITER = #{loginUserNo};
    </update>
    
</mapper>
      

